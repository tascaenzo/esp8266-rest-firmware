<section class="doc" id="setup-view">
  <header class="doc-header">
    <div>
      <h2>Device setup</h2>
      <p class="lead">
        Configure firmware-wide flags such as authentication and serial debug without leaving the console.
        The request mirrors <code>POST /api/setup</code> and follows the same HMAC rules used elsewhere.
      </p>
    </div>
    <div class="doc-actions">
      <button id="setup-apply" class="btn-primary">Apply setup</button>
    </div>
  </header>

  <section class="card-grid">
    <div class="card">
      <header>
        <h3>What this affects</h3>
        <small>Firmware behavior</small>
      </header>
      <ul class="tight">
        <li>Enable/disable authentication for every endpoint</li>
        <li>Toggle serial debug output for troubleshooting</li>
        <li>Resets cached RuntimeState after applying</li>
      </ul>
      <p class="muted">
        This page is strictly about device configuration; client-side settings stay in the settings overlay.
      </p>
    </div>

    <div class="card">
      <header>
        <h3>Form payload</h3>
        <small>Mirrors firmware JSON</small>
      </header>
      <div class="form-stack">
        <label class="stacked">
          Authentication
          <div class="option-row">
            <div>
              <div class="option-title">Require HMAC</div>
              <small>When enabled, every call is signed using your auth key.</small>
            </div>
            <label class="switch">
              <input type="checkbox" id="setup-auth" />
              <span class="slider"></span>
            </label>
          </div>
        </label>

        <label class="stacked">
          Serial debug
          <div class="option-row">
            <div>
              <div class="option-title">UART logging</div>
              <small>Helpful for development; disable on production devices.</small>
            </div>
            <label class="switch">
              <input type="checkbox" id="setup-serial" />
              <span class="slider"></span>
            </label>
          </div>
        </label>
      </div>
      <p id="setup-status" class="muted"></p>
    </div>
  </section>

  <section class="card surface">
    <header>
      <div>
        <div class="eyebrow">Backend call</div>
        <h3>POST /api/setup</h3>
        <small id="setup-auth-mode">Signed automatically when runtime auth is enabled</small>
      </div>
      <div class="pill">Configuration</div>
    </header>
    <div class="api-grid">
      <div>
        <p class="muted">Payload generated from the switches above.</p>
        <div class="json-launcher">
          <button id="setup-payload-open" class="btn-tertiary">Apri payload</button>
          <small class="muted">Usa i toggle per rigenerare</small>
        </div>
      </div>
      <div>
        <p class="muted">Copy/paste curl with live headers.</p>
        <pre class="code"><code id="setup-curl"></code></pre>
      </div>
      <div>
        <p class="muted">Ultima risposta ricevuta dal microcontrollore.</p>
        <div class="json-launcher">
          <button id="setup-response-open" class="btn-tertiary">Apri risposta</button>
          <small id="setup-response-hint" class="muted">Nessuna chiamata ancora</small>
        </div>
      </div>
    </div>
  </section>
</section>
